services:
  n8n:    
    container_name: n8n_server # コンテナ名を指定 (任意)
    restart: unless-stopped # コンテナが停止した場合、手動で停止しない限り再起動
    ports:
      - "8080:8080" # ホストOSの8080番ポートをコンテナの8080番ポートに接続
    environment:
      - N8N_ENCRYPTION_KEY=IWKnJGOZrBTVn3MFBMebkWl+z7fp8STId17KhN20FQU=
      - GENERIC_TIMEZONE=Asia/Tokyo
      - VOICEVOX_ENGINE_URL=http://voicevox:50021
      - N8N_PORT=8080
    volumes:
      # n8nの設定データやワークフローデータを永続化するためのボリューム
      - n8n_data:/home/node/.n8n
      # workflowディレクトリをコンテナにマウント（手動インポート用）
      - ./workflow:/workflows:ro
    depends_on:
     - voicevox
    build:
      context: .
      dockerfile: ./n8n-server/Dockerfile
    #command: ["npm", "run", "import"]

  voicevox:
    image: voicevox/voicevox_engine:latest
    container_name: voicevox_local
    restart: unless-stopped
    # VOICEVOX エンジンはデフォルトで 50021 ポートで HTTP API を提供します
    ports:
      - "50021:50021"
    # 必要に応じてモデルの永続化や追加の環境変数を設定してください
    volumes:
      - voicevox_models:/var/lib/voicevox

volumes:
  n8n_data:
  voicevox_models: